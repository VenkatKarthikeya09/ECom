<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Checkout - Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<main class="container my-5 pt-5">
    <h3 class="mb-3">Payment method</h3>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <form method="post" action="/checkout/payment-method" class="mb-3" id="methodForm">
        <div class="btn-group" role="group">
            <input type="radio" class="btn-check" name="method" id="pm-card" value="CARD" th:checked="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).CARD}" onchange="document.getElementById('methodForm').submit()">
            <label class="btn btn-outline-primary" for="pm-card">Card (Credit/Debit)</label>
            <input type="radio" class="btn-check" name="method" id="pm-upi" value="UPI_QR" th:checked="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).UPI_QR}" onchange="document.getElementById('methodForm').submit()">
            <label class="btn btn-outline-primary" for="pm-upi">UPI / QR</label>
            <input type="radio" class="btn-check" name="method" id="pm-cod" value="COD" th:checked="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).COD}" onchange="document.getElementById('methodForm').submit()">
            <label class="btn btn-outline-primary" for="pm-cod">Cash on Delivery</label>
        </div>
    </form>

    <div th:if="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).CARD}" class="card card-body mb-3">
        <form method="post" action="/checkout/payment/card" th:object="${details}">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Card holder name</label>
                    <input class="form-control" th:field="*{cardHolder}" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Card number</label>
                    <input class="form-control" th:field="*{cardNumber}" minlength="12" maxlength="19" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Expiry month</label>
                    <input class="form-control" type="number" th:field="*{expiryMonth}" min="1" max="12" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Expiry year</label>
                    <input class="form-control" type="number" th:field="*{expiryYear}" min="2025" max="2100" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">CVV</label>
                    <input class="form-control" th:field="*{cvv}" minlength="3" maxlength="4" required>
                </div>
                <div class="col-12 d-flex justify-content-end">
                    <button class="btn btn-gold">Pay now</button>
                </div>
            </div>
        </form>
    </div>

    <div th:if="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).UPI_QR}" class="card card-body mb-3">
        <div class="row g-3">
            <div class="col-md-6">
                <form method="post" action="/checkout/payment/upi" th:object="${details}">
                    <label class="form-label">UPI ID</label>
                    <input class="form-control" th:field="*{upiId}" placeholder="name@bank" required>
                    <div class="mt-3 d-flex justify-content-end">
                        <button class="btn btn-gold">Proceed</button>
                    </div>
                </form>
            </div>
            <div class="col-md-6 text-center">
                <div class="border p-3 rounded">
                    <div class="fw-bold mb-2">Scan QR to pay</div>
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi%3A%2F%2Fpay%3Fpa%3Ddemo%40upi%26pn%3DEcom%26am%3D123.45" alt="QR">
                </div>
            </div>
        </div>
    </div>

    <div th:if="${method == T(com.example.ecom.model.CheckoutSession.PaymentMethod).COD}" class="alert alert-info">
        Cash on delivery selected. Continue to confirm your order.
        <form method="post" action="/checkout/cod" class="mt-2">
            <button class="btn btn-gold">Confirm COD</button>
        </form>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 